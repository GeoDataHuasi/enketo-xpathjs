XPathJS=(function(){var w,r,m,b,s,z,c,o,C,t,u,h=[],d="http://www.w3.org/XML/1998/namespace",A="http://www.w3.org/2000/xmlns/",n="http://www.w3.org/1999/xhtml",q,B,x,y,g,v=function(E){return E.ownerDocument},l=function(F){var E=[],G=function(H,J){var K,I,L=[];for(I=0;I<H.length;I++){K=H.item(I);if(false!==arrayIndexOf(K.nodeType,J)){L.push(K)}}return L};switch(F.nodeType){case 1:E=G(F.childNodes,supportedChildNodeTypes=[1,3,4,7,8]);break;case 9:E=G(F.childNodes,supportedChildNodeTypes=[1,7,8]);break;case 2:case 3:case 4:case 7:case 8:case 13:break;default:throw new Error("Internal Error: nodeChildren - unsupported node type: "+F.nodeType);break}return E},j=function(H){var F,G,E=[];F=l(H);for(G=0;G<F.length;G++){E.push(F[G]);E.push.apply(E,j(F[G]))}return E},f=function(F){var E;switch(F.nodeType){case 1:case 3:case 4:case 7:case 8:case 9:return F.parentNode;break;case 2:if(F.ownerElement){return F.ownerElement}E=nodeAttributeSearch(F.ownerDocument,true,function(G,H){if(H===F){return true}});return E;break;case 13:return F.ownerElement;break;default:throw new Error("Internal Error: nodeParent - node type not supported: "+F.type);break}},a=function(G){var F,E=[];while(F=f(G)){E.push(F);G=F}return E},i=function(E){return D(E,"nextSibling")},k=function(E){return D(E,"previousSibling")},D=function(H,G){var F,E=[];while(F=H[G]){switch(F.nodeType){case 1:case 3:case 4:case 7:case 8:case 9:E.push(F);break;default:break}H=F}return E},p=function(I){var E=[],G,H,J,F;G=a(I);G.unshift(I);for(H=0;H<G.length;H++){J=i(G[H]);for(F=0;F<J.length;F++){E.push(J[F]);E.push.apply(E,j(J[F]))}}return E},e=function(I){var E=[],G,H,J,F;G=a(I);G.unshift(I);for(H=0;H<G.length;H++){J=k(G[H]);for(F=0;F<J.length;F++){E.push.apply(E,j(J[F]).reverse());E.push(J[F])}}return E},v=function(E){switch(E.nodeType){case 9:return E;default:return E.ownerDocument}};nodeAttribute=function(G){var E=[],F;if(G.nodeType===1){for(F=0;F<G.attributes.length;F++){if(!G.attributes[F].specified){continue}if(false===isNamespaceAttributeNode(G.attributes[F])){E.push(G.attributes[F])}}}return E},nodeNamespace=function(I,J){var E=(J||[]),G,F,H;if(I.nodeType===1){if(I.ownerDocument.documentElement===I&&typeof I.ownerDocument.namespaces==="object"){for(G=I.ownerDocument.namespaces.length-1;G>=0;G--){H=I.ownerDocument.namespaces.item(G);insertNamespaceIfNotDeclared.call(this,E,H.name,H.urn,I)}}for(G=I.attributes.length-1;G>=0;G--){if(!I.attributes[G].specified){continue}if(false===(F=isNamespaceAttributeNode(I.attributes[G]))){continue}if(F.length===1){insertNamespaceIfNotDeclared.call(this,E,"",I.attributes[G].nodeValue,I);continue}insertNamespaceIfNotDeclared.call(this,E,F[1],I.attributes[G].nodeValue,I)}nodeNamespace.call(this,I.parentNode,E);if(J===undefined){insertNamespaceIfNotDeclared.call(this,E,"xml",d,I);if(E[0]&&E[0].prefix===""&&E[0].namespaceURI===""){E.shift()}}if(J===undefined){for(G=0;G<E.length;G++){if(E[G].ownerElement!==I){E[G]=createNamespaceNode(E[G].prefix,E[G].nodeValue,I)}}}}return E},insertNamespaceIfNotDeclared=function(J,I,H,G){var E,F;if(!this.opts["case-sensitive"]){I=I.toLowerCase()}for(E=0;E<J.length;E++){if(J[E].prefix===I){return false}}F=createNamespaceNode(I,H,G);if(I===""&&H!==null){J.unshift(F)}else{J.push(F)}return true},isNamespaceAttributeNode=function(F){var E=F.nodeName.split(":");if(E[0]==="xmlns"){return E}return false},nodeIdAttribute=function(I,H){var L,J,K,G,M,E,F;if(I.nodeType===1){K=(!H)?nodeAttribute(I):[H];G=nodeNamespace.call(this,I);for(L=0;L<K.length;L++){E=K[L].nodeName.split(":");if(E.length===1){E[1]=E[0];E[0]=""}M=null;for(J=0;J<G.length;J++){if(G[J].prefix===E[0]){M=G[J].namespaceURI;break}}if(M===null){M=""}if(this.opts["unique-ids"][M]===E[1]){return K[L]}}}return null},nodeAttributeSearch=function(F,I,J){var H,E,L,G,K=[];L=F.getElementsByTagName("*");for(H=0;H<L.length;H++){G=L.item(H);if(G.nodeType!=1){continue}for(E=0;E<G.attributes.length;E++){if(!G.attributes[E].specified){continue}if(J(G,G.attributes[E])===true){if(I){return G}else{K.push(G);break}}}}if(I){return null}else{return K}},nodeExpandedName=function(G){var E,H,F,I;switch(G.nodeType){case 1:if(typeof G.scopeName!="undefined"){I={prefix:(G.scopeName=="HTML")?"":G.scopeName,name:G.nodeName}}else{E=G.nodeName.split(":");if(E.length==1){I={prefix:"",name:E[0]}}else{I={prefix:E[0],name:E[1]}}}if(!this.opts["case-sensitive"]){I.prefix=I.prefix.toLowerCase();I.name=I.name.toLowerCase()}H=nodeNamespace.call(this,G);for(F=0;F<H.length;F++){if(H[F].prefix===I.prefix){I.ns=H[F].namespaceURI;return I}}if(I.prefix===""){I.ns=null;return I}throw new Error('Internal Error: nodeExpandedName - Failed to expand namespace prefix "'+I.prefix+'" on element: '+G.nodeName);break;case 2:E=G.nodeName.split(":");if(E.length==1){return{prefix:"",ns:null,name:E[0]}}I={prefix:E[0],name:E[1]};if(!this.opts["case-sensitive"]){I.prefix=I.prefix.toLowerCase();I.name=I.name.toLowerCase()}H=nodeNamespace.call(this,f(G));for(F=0;F<H.length;F++){if(H[F].prefix===I.prefix){I.ns=H[F].namespaceURI;return I}}throw new Error('Internal Error: nodeExpandedName - Failed to expand namespace prefix "'+I.prefix+'" on attribute: '+G.nodeName);break;case 13:return{prefix:null,ns:null,name:((!this.opts["case-sensitive"])?G.prefix:G.prefix.toLowerCase())};break;case 7:return{prefix:null,ns:null,name:((!this.opts["case-sensitive"])?G.target:G.target.toLowerCase())};break;default:return false;break}},nodeStringValue=function(G){var F,E,H="";switch(G.nodeType){case 9:case 1:E=o(new u(G,1,1,{},{},{}),{type:"step",args:["descendant",{type:"nodeType",args:["text",[]]}]});E.sortDocumentOrder();for(F=0;F<E.value.length;F++){H+=E.value[F].data}return H;break;case 2:return G.nodeValue;break;case 13:return G.namespaceURI;break;case 7:case 8:case 3:case 4:return G.data;break;default:throw new Error("Internal Error: nodeStringValue does not support node type: "+G.nodeType);break}},createError=function(H,E,G){var F=new Error(G);F.name=E;F.code=H;return F},arrayIndexOf=function(G,F){var E=F.length;while(E--){if(F[E]===G){return E}}return false},compareOperator=function(H,K,F,G){var J,I,L,E,M;if(H instanceof g){if(K instanceof g){E=K.stringValues();L=H.stringValues();for(J=0;J<L.length;J++){for(I=0;I<E.length;I++){M=compareOperator(L[J],E[I],F,G);if(M.toBoolean()){return M}}}}else{if(K instanceof y){L=H.stringValues();for(J=0;J<L.length;J++){M=compareOperator(new y(L[J].toNumber()),K,F,G);if(M.toBoolean()){return M}}}else{if(K instanceof x){L=H.stringValues();for(J=0;J<L.length;J++){M=compareOperator(L[J],K,F,G);if(M.toBoolean()){return M}}}else{return compareOperator(new B(H.toBoolean()),K,F,G)}}}}else{if(K instanceof g){if(H instanceof y){E=K.stringValues();for(J=0;J<E.length;J++){M=compareOperator(H,new y(E[J].toNumber()),F,G);if(M.toBoolean()){return M}}}else{if(H instanceof x){E=K.stringValues();for(J=0;J<E.length;J++){M=compareOperator(H,E[J],F,G);if(M.toBoolean()){return M}}}else{return compareOperator(H,new B(K.toBoolean()),F,G)}}}else{switch(F){case"=":case"!=":if(H instanceof B||K instanceof B){return new B(G(H.toBoolean(),K.toBoolean()))}else{if(H instanceof y||K instanceof y){return new B(G(H.toNumber(),K.toNumber()))}}return new B(G(H.toString(),K.toString()));break;default:return new B(G(H.toNumber(),K.toNumber()));break}}}return new B(false)},getComparableNode=function(E){switch(E.nodeType){case 2:case 13:throw new Error("Internal Error: getComparableNode - Node type not implemented: "+E.nodeType);return f(E);break;case 3:case 4:case 7:case 8:return E.parentNode;break;case 1:case 9:return E;break;default:throw new Error("Internal Error: getComparableNode - Node type not supported: "+E.nodeType);break}},compareDocumentPosition=function(H,G){var F,I,E,K,J,L;if(H.compareDocumentPosition){return H.compareDocumentPosition(G)}if(H===G){return 0}F=getComparableNode(H);I=getComparableNode(G);if(F.nodeType===9){if(I.nodeType===9){if(F!==I){return 1}else{E=0}}else{if(F!==I.ownerDocument){return 1}else{E=4+16}}}else{if(I.nodeType===9){if(I!==F.ownerDocument){return 1}else{E=2+8}}else{if(F.ownerDocument!==I.ownerDocument){return 1}else{if(!F.contains||typeof F.sourceIndex==="undefined"||!I.contains||typeof I.sourceIndex==="undefined"){throw new Error('Cannot compare elements. Neither "compareDocumentPosition" nor "contains" available.')}else{E=(F!=I&&F.contains(I)&&16)+(F!=I&&I.contains(F)&&8)+(F.sourceIndex>=0&&I.sourceIndex>=0?(F.sourceIndex<I.sourceIndex&&4)+(F.sourceIndex>I.sourceIndex&&2):1)+0}}}}if(H===F){if(G===I){return E}else{if(E===0||(E&16)===16){return E}else{if((E&8)===8){K=H;while(K.parentNode!==I){K=K.parentNode}for(J=0;J<I.childNodes.length;J++){L=I.childNodes.item(J);if(L===K){return 4}else{if(L===G){return 2}}}throw new Error("Internal Error: should not get to here. 1")}else{return E}}}}else{if(G===I){if(E===0||(E&8)===8){return E}else{if((E&16)===16){K=G;while(K.parentNode!==F){K=K.parentNode}for(J=0;J<F.childNodes.length;J++){L=F.childNodes.item(J);if(L===K){return 2}else{if(L===H){return 4}}}throw new Error("Internal Error: should not get to here. 2")}else{return E}}}else{if((E&16)===16){K=I;while(K.parentNode!==F){K=K.parentNode}for(J=0;J<F.childNodes.length;J++){L=F.childNodes.item(J);if(L===K){return 2}else{if(L===H){return 4}}}throw new Error("Internal Error: should not get to here. 3")}if((E&8)===8){K=F;while(K.parentNode!==I){K=K.parentNode}for(J=0;J<I.childNodes.length;J++){L=I.childNodes.item(J);if(L===K){return 4}else{if(L===G){return 2}}}throw new Error("Internal Error: should not get to here. 3")}else{if(E===0){for(J=0;J<F.childNodes.length;J++){L=F.childNodes.item(J);if(L===G){return 2}else{if(L===H){return 4}}}throw new Error("Internal Error: should not get to here. 4")}else{return E}}}}throw new Error("Internal Error: should not get to here. 5")},nodeSupported=function(E){if(!E||typeof E.nodeType!=="number"||(E.nodeType!=9&&E.nodeType!=1&&E.nodeType!=2&&E.nodeType!=3&&E.nodeType!=4&&E.nodeType!=8&&E.nodeType!=7&&E.nodeType!=13)){throw createError(9,"NOT_SUPPORTED_ERR","The supplied node type is not supported. (nodeType: "+E.nodeType+")")}if(E.nodeType==2&&!E.specified){throw createError(9,"NOT_SUPPORTED_ERR","The supplied node is a non-specified attribute node. Only specified attribute nodes are supported.")}},createNamespaceNode=function(I,H,G){var E,F;for(E=0;E<h.length;E++){F=h[E];if(F.prefix===I&&F.nodeValue===H&&F.ownerElement===G){return F}}F=new z(I,H,G);h.push(F);return F};q=function(G,F,E){this.value=G;this.type=F;this.supports=E};q.prototype={value:null,type:null,supports:[],toBoolean:function(){throw new Error('Unable to convert "'+this.type+'" to "boolean".')},toString:function(){throw new Error('Unable to convert "'+this.type+'" to "string".')},toNumber:function(){throw new Error('Unable to convert "'+this.type+'" to "number".')},toNodeSet:function(){throw new Error('Unable to convert "'+this.type+'" to "node-set".')},canConvertTo:function(E){return false!==arrayIndexOf(E,this.supports)}};B=function(E){q.call(this,E,"boolean",["boolean","string","number"])};B.prototype=new q;B.constructor=B;B.prototype.toBoolean=function(){return this.value};B.prototype.toString=function(){return(this.value===true)?"true":"false"};B.prototype.toNumber=function(){return(this.value)?1:0};g=function(F,E){q.call(this,F,"node-set",["boolean","string","number","node-set"]);this.docOrder=(E||"unsorted")};g.prototype=new q;g.constructor=g;g.prototype.toBoolean=function(){return(this.value.length>0)?true:false};g.prototype.toString=function(){if(this.value.length<1){return""}this.sortDocumentOrder();return nodeStringValue(this.value[0])};g.prototype.toNumber=function(){return(new x(this.toString())).toNumber()};g.prototype.toNodeSet=function(){return this.value};g.prototype.sortDocumentOrder=function(){switch(this.docOrder){case"document-order":break;case"reverse-document-order":this.value.reverse();break;default:this.value.sort(function(G,F){var E=compareDocumentPosition(G,F);if((E&4)==4){return -1}else{if((E&2)==2){return 1}else{throw new Error("NodeSetType.sortDocumentOrder - unexpected compare result: "+E)}}});break}this.docOrder="document-order"};g.prototype.sortReverseDocumentOrder=function(){switch(this.docOrder){case"document-order":this.value.reverse();break;case"reverse-document-order":break;default:this.sortDocumentOrder();this.value.reverse();break}this.docOrder="reverse-document-order"};g.prototype.append=function(F){var I,H=0,G=0,E;if(!F instanceof g){throw new Error("NodeSetType can be passed into NodeSetType.append method")}this.sortDocumentOrder();F.sortDocumentOrder();while(H<this.value.length&&G<F.value.length){E=compareDocumentPosition(this.value[H],F.value[G]);if(E==0){G++}else{if((E&4)==4){H++}else{if((E&2)==2){this.value.splice(H,0,F.value[G]);H++;G++}else{throw new Error("Internal Error: NodeSetType.append - unable to sort nodes. (result: "+E+")")}}}}for(;G<F.value.length;G++){this.value.push(F.value[G])}this.docOrder="document-order"};g.prototype.stringValues=function(){var F,E=[];for(F=0;F<this.value.length;F++){E.push(new x(nodeStringValue(this.value[F])))}return E};x=function(E){q.call(this,E,"string",["boolean","string","number"])};x.prototype=new q;x.constructor=x;x.prototype.toBoolean=function(){return(this.value.length>0)?true:false};x.prototype.toString=function(){return this.value};x.prototype.toNumber=function(){var E;E=this.value.match(/^[ \t\r\n]*(-?[0-9]+(?:[.][0-9]*)?)[ \t\r\n]*$/);if(E!==null){return parseFloat(E[1])}E=this.value.match(/^[ \t\r\n]*(-?[.][0-9]+)[ \t\r\n]*$/);if(E!==null){return parseFloat(E[1])}return Number.NaN};y=function(E){q.call(this,E,"number",["boolean","string","number"])};y.prototype=new q;y.constructor=y;y.prototype.toBoolean=function(){return(this.value!==0&&!isNaN(this.value))?true:false};y.prototype.toString=function(){return this.value.toString()};y.prototype.toNumber=function(){return this.value};w=function(G,F){var E;this.code=G;switch(this.code){case w.INVALID_EXPRESSION_ERR:this.name="INVALID_EXPRESSION_ERR";break;case w.TYPE_ERR:this.name="TYPE_ERR";break;default:E=new Error("Unsupported XPathException code: "+this.code);E.name="XPathExceptionInternalError";throw E;break}this.message=(F||"")};w.prototype.toString=function(){return'XPathException: "'+this.message+'", code: "'+this.code+'", name: "'+this.name+'"'};w.INVALID_EXPRESSION_ERR=51;w.TYPE_ERR=52;r=function(F){var G,E,H;for(G in F){H=false;for(E in this.opts){if(G===E){this.opts[G]=F[G];H=true;break}}if(H){continue}throw new Error("Unsupported option: "+G)}this.opts["unique-ids"][d]="id";this.opts["unique-ids"][n]="id"};r.prototype={opts:{"unique-ids":{},"case-sensitive":true},createExpression:function(L,K){var E,I,G,F={},J;try{E=xpathParser.parse(L)}catch(H){I="The expression is not a legal expression.";if(H instanceof xpathParser.SyntaxError){I+=" (line: "+H.line+", character: "+H.column+")"}else{I+=" ("+H.message+")"}throw new w(w.INVALID_EXPRESSION_ERR,I)}if(E.nsPrefixes.length>0){if(typeof K!="object"||typeof K.lookupNamespaceURI==="undefined"){throw new w(w.INVALID_EXPRESSION_ERR,"No namespace resolver provided or lookupNamespaceURI function not supported.")}for(G=0;G<E.nsPrefixes.length;G++){J=E.nsPrefixes[G];F[J]=K.lookupNamespaceURI(J);if(F[J]===null){throw createError(14,"NAMESPACE_ERR",'Undefined namespace prefix "'+J+'" in the context of the given resolver.')}}}return new m(E,F,this.opts)},createNSResolver:function(E){return new b(E)},evaluate:function(I,F,H,G,E){var I=this.createExpression(I,H);return I.evaluate(F,G,E)}};m=function(F,E,G){this.parsedExpression=F;this.namespaceMapping=E;this.opts=G||{}};m.prototype={parsedExpression:null,namespaceMapping:null,opts:{},evaluate:function(F,H,E){var G;nodeSupported(F);G=new u(F,1,1,{},t,this.namespaceMapping,this.opts);return new s(G,H,o(G,this.parsedExpression.tree))}};u=function(I,E,H,K,J,G,F){this.node=I;this.pos=E;this.size=H;this.vars=K;this.fns=J;this.nsMap=G;this.opts=F||{}};u.prototype={node:null,pos:null,size:null,vars:null,fns:null,nsMap:null,opts:null,clone:function(G,E,F){return new u(G||this.node,(typeof E!="undefined")?E:this.pos,(typeof F!="undefined")?F:this.size,this.vars,this.fns,this.nsMap,this.opts)}};b=function(E){nodeSupported(E);this.node=E};b.prototype={node:null,lookupNamespaceURI:function(I){var H=this.node,E,G,F;switch(I){case"xml":return d;break;case"xmlns":return A;break;default:switch(this.node.nodeType){case 9:H=H.documentElement;break;case 1:break;default:H=f(H);break}if(H!=null&&H.nodeType==1){if(""==I){G=H.getAttribute("xmlns");if(G!==null){return G}}else{if(H.ownerDocument.documentElement===H&&typeof H.ownerDocument.namespaces==="object"){for(E=0;E<H.ownerDocument.namespaces.length;E++){G=H.ownerDocument.namespaces.item(E);if(G.name==I){return G.urn}}}else{for(E=0;E<H.attributes.length;E++){if(!H.attributes[E].specified){continue}if("xmlns:"+I==H.attributes[E].nodeName){return H.attributes[E].nodeValue}}}}if(H.ownerDocument.documentElement!==H&&H.parentNode){F=this.node;this.node=H.parentNode;G=this.lookupNamespaceURI(I);this.node=F;return G}}return null;break}}};C={"/":function(K,I){var J,H,E,F,G,L;if(K===null){E=new g([v(this.node)],"document-order")}else{E=o(this,K);if(!E instanceof g){throw new Error("Left side of path separator (/) must be of node-set type. (type: "+E.type+")")}}if(I===null){G=E}else{G=new g([],"document-order");for(H=0;H<E.value.length;H++){L=this.clone(E.value[H]);F=o(L,I);if(!F instanceof g){throw new Error("Right side of path separator (/) must be of node-set type. (type: "+F.type+")")}G.append(F)}}return G},step:function(I,J){var K,M,H,E,G,L,F;switch(I){case"child":K=new g(l(this.node),"document-order");break;case"descendant":K=new g(j(this.node),"document-order");break;case"parent":H=f(this.node);K=new g((!H)?[]:[H],"document-order");break;case"ancestor":K=new g(a(this.node),"reverse-document-order");break;case"following-sibling":K=new g(i(this.node),"document-order");break;case"preceding-sibling":K=new g(k(this.node),"reverse-document-order");break;case"following":K=new g(p(this.node),"document-order");break;case"preceding":K=new g(e(this.node),"reverse-document-order");break;case"attribute":K=new g(nodeAttribute(this.node),"document-order");break;case"namespace":K=new g(nodeNamespace.call(this,this.node),"document-order");break;case"self":K=new g([this.node],"document-order");break;case"descendant-or-self":E=j(this.node);E.unshift(this.node);K=new g(E,"document-order");break;case"ancestor-or-self":E=a(this.node);E.unshift(this.node);K=new g(E,"reverse-document-order");break;default:throw new Error("Axis type not supported: "+I);break}switch(J.type){case"nodeType":if(J.args[0]=="node"){break}for(M=K.value.length-1;M>=0;M--){switch(J.args[0]){case"text":if(K.value[M].nodeType!=3&&K.value[M].nodeType!=4){K.value.splice(M,1)}break;case"comment":if(K.value[M].nodeType!=8){K.value.splice(M,1)}break;case"processing-instruction":if(K.value[M].nodeType!=7||(J.args[1].length>0&&o(this,J.args[1][0])!=K.value[M].nodeName)){K.value.splice(M,1)}break}}break;case"name":G=o(this,J);switch(I){case"attribute":L=2;break;case"namespace":L=13;break;default:L=1;break}for(M=K.value.length-1;M>=0;M--){if(K.value[M].nodeType!=L){K.value.splice(M,1);continue}if(G.ns===null&&G.name===null){continue}F=nodeExpandedName.call(this,K.value[M]);if(F===false||F.ns!==G.ns){K.value.splice(M,1);continue}if(G.name!==null&&F.name.toLowerCase()!=G.name.toLowerCase()){K.value.splice(M,1)}}break;default:throw new Error("NodeTest type not supported in step: "+J.type);break}return K},predicate:function(F,L,G){var J,K,M,I,H,E;J=o(this,L);if(!J instanceof g){throw new Error('Expected "node-set", got: '+J.type)}switch(F){case"ancestor":case"ancestor-or-self":case"preceding":case"preceding-sibling":J.sortReverseDocumentOrder();break;default:J.sortDocumentOrder();break}for(I=0;I<G.length;I++){for(K=0,H=1,E=J.value.length;K<J.value.length;H++){M=o(this.clone(J.value[K],H,E),G[I]);if(M instanceof y){if(M.value!=H){J.value.splice(K,1);continue}}else{if(!M.toBoolean()){J.value.splice(K,1);continue}}K++}}return J},"function":function(E,M){var G,N=[],O=function(P){return((P.ns!==null)?"{"+P.ns+"}":"{}")+P.name},L=function(P){var R,Q=[],S;for(R=0;R<P.length;R++){S=(P[R].t===undefined)?"object":P[R].t;if(P[R].r!==false){if(P[R].rep===true){S+="+"}}else{if(P[R].rep===true){S+="*"}else{S+="?"}}Q.push(S)}return"("+Q.join(", ")+")"},H,K,I=0,J=[],F;G=o(this,E);if(G.ns===null){G.ns=""}if(!this.fns[G.ns]||!this.fns[G.ns][G.name]){throw new Error('Function "'+O(G)+'" does not exist.')}H=this.fns[G.ns][G.name];if(!H.args){H.args=[]}for(K=0,I=0;K<H.args.length;I++,K++){if(M[I]===undefined){if(H.args[K].r!==false){throw new Error('Function "'+O(G)+'" expects '+L(H.args)+".")}}else{J.push((H.args[K].t===undefined)?"object":H.args[K].t)}if(H.args[K].rep===true){for(;I<M.length;I++){J.push((H.args[K].t===undefined)?"object":H.args[K].t)}break}}if(J.length<M.length){throw new Error('Function "'+O(G)+'" expects '+L(H.args)+".")}for(K=0;K<M.length;K++){F=o(this,M[K]);if(J[K]!=="object"&&!F.canConvertTo(J[K])){throw new Error('Function "'+O(G)+'" expects '+L(H.args)+'.Cannot convert "'+F.type+'" to "'+J[K]+'".')}N.push(F)}result=H.fn.apply(this,N);if(!result instanceof q){throw new Error('Function "'+O(G)+'" did not return a value that inherits from BaseType.')}else{if(H.ret!=="object"&&!result.canConvertTo(H.ret)){throw new Error('Function "'+O(G)+'" return "'+result.type+'" type that cannot be converted to "'+H.ret+'".')}}return result},"|":function(F,E){F=o(this,F);E=o(this,E);if(typeof F=="undefined"||typeof E=="undefined"||!F instanceof g||!E instanceof g){throw new Error('Unable to perform union on non-"node-set" types.')}F.append(E);return F},or:function(F,E){if(o(this,F).toBoolean()){return new B(true)}return new B(o(this,E).toBoolean())},and:function(F,E){if(o(this,F).toBoolean()){return new B(o(this,E).toBoolean())}return new B(false)},"=":function(F,E){return compareOperator.call(this,o(this,F),o(this,E),"=",function(H,G){return H==G})},"!=":function(F,E){return compareOperator.call(this,o(this,F),o(this,E),"!=",function(H,G){return H!=G})},"<=":function(F,E){return compareOperator.call(this,o(this,F),o(this,E),"<=",function(H,G){return H<=G})},"<":function(F,E){return compareOperator.call(this,o(this,F),o(this,E),"<",function(H,G){return H<G})},">=":function(F,E){return compareOperator.call(this,o(this,F),o(this,E),">=",function(H,G){return H>=G})},">":function(F,E){return compareOperator.call(this,o(this,F),o(this,E),">",function(H,G){return H>G})},"+":function(F,E){return new y(o(this,F).toNumber()+o(this,E).toNumber())},"-":function(F,E){return new y(o(this,F).toNumber()-o(this,E).toNumber())},div:function(F,E){return new y(o(this,F).toNumber()/o(this,E).toNumber())},mod:function(F,E){return new y(o(this,F).toNumber()%o(this,E).toNumber())},"*":function(F,E){return new y(o(this,F).toNumber()*o(this,E).toNumber())},string:function(E){return new x(E)},number:function(E){return new y(E)},"$":function(E){throw new Error("TODO: Not implemented.16")},name:function(G,E){var F=null;if(G!==null){F=this.nsMap[G];if(!F){throw new Error('Namespace prefix "'+G+'" is not mapped to a namespace.')}}return{ns:F,name:E}}};t={"":{last:{fn:function(){return new y(this.size)},ret:"number"},position:{fn:function(){return new y(this.pos)},ret:"number"},count:{fn:function(E){return new y(E.toNodeSet().length)},args:[{t:"node-set"}],ret:"number"},id:{fn:function(I){var G=this,E=[],K,J,H,F=[],M,L=function(O){var N,P=O.split(/[\u0020\u0009\u000D\u000A]+/);for(N=P.length-1;N>=0;N--){if(P[N].length==0){P.splice(N,1)}}return P};if(I instanceof g){for(K=0;K<I.value.length;K++){E.push.apply(E,L(nodeStringValue(I.value[K])))}}else{I=I.toString();E=L(I)}for(K=E.length-1;K>=0;K--){for(J=K-1;J>=0;J--){if(E[K]==E[J]&&K!=J){E.splice(K,1);break}}}for(K=0;K<E.length;K++){H=v(this.node).getElementById(E[K]);if(H){if(nodeIdAttribute.call(this,H)){F.push(H);continue}}nodeAttributeSearch(v(this.node),true,function(N,P){var O=nodeIdAttribute.call(G,N,P);if(O&&O.nodeValue==E[K]){F.push(N);return true}})}return new g(F)},args:[{}],ret:"node-set"},"local-name":{fn:function(F){var G,E="";if(arguments.length==0){F=new g([this.node])}if(F.toNodeSet().length>0){F.sortDocumentOrder();G=nodeExpandedName.call(this,F.value[0]);if(G!==false){E=G.name}}return new x(E)},args:[{t:"node-set",r:false}],ret:"string"},"namespace-uri":{fn:function(E){var G,F="";if(arguments.length==0){E=new g([this.node])}if(E.toNodeSet().length>0){E.sortDocumentOrder();G=nodeExpandedName.call(this,E.value[0]);if(G!==false&&G.ns!==null){F=G.ns}}return new x(F)},args:[{t:"node-set",r:false}],ret:"string"},name:{fn:function(E){var G,F="";if(arguments.length==0){E=new g([this.node])}if(E.toNodeSet().length>0){E.sortDocumentOrder();G=nodeExpandedName.call(this,E.value[0]);if(G!==false){F=(G.prefix&&G.prefix.length>0)?G.prefix+":"+G.name:G.name}}return new x(F)},args:[{t:"node-set",r:false}],ret:"string"},string:{fn:function(E){if(arguments.length==0){E=new g([this.node],"document-order")}return new x(E.toString())},args:[{t:"object",r:false}],ret:"string"},concat:{fn:function(H,F){var E,G="";for(E=0;E<arguments.length;E++){G+=arguments[E].toString()}return new x(G)},args:[{t:"string"},{t:"string"},{t:"string",r:false,rep:true}],ret:"string"},"starts-with":{fn:function(E,F){return new B(E.toString().substr(0,(F=F.toString()).length)==F)},args:[{t:"string"},{t:"string"}],ret:"string"},contains:{fn:function(E,F){return new B(E.toString().indexOf(F=F.toString())!=-1)},args:[{t:"string"},{t:"string"}],ret:"string"},"substring-before":{fn:function(E,F){E=E.toString();F=E.indexOf(F.toString());return new x(F==-1?"":E.substr(0,F))},args:[{t:"string"},{t:"string"}],ret:"string"},"substring-after":{fn:function(E,F){var G;E=E.toString();F=F.toString();G=E.indexOf(F);return new x(G==-1?"":E.substr(G+F.length))},args:[{t:"string"},{t:"string"}],ret:"string"},substring:{fn:function(F,G,E){F=F.toString();G=Math.round(G.toNumber())-1;return new x(isNaN(G)?"":((arguments.length==2)?F.substring(G<0?0:G):F.substring(G<0?0:G,G+Math.round(E.toNumber()))))},args:[{t:"string"},{t:"number"},{t:"number",r:false}],ret:"string"},"string-length":{fn:function(E){E=(arguments.length==0)?nodeStringValue(this.node):E.toString();return new y(E.length)},args:[{t:"string",r:false}],ret:"number"},"normalize-space":{fn:function(E){E=(arguments.length==0)?nodeStringValue(this.node):E.toString();return new x(E.replace(/^[\u0020\u0009\u000D\u000A]+/,"").replace(/[\u0020\u0009\u000D\u000A]+$/,"").replace(/[\u0020\u0009\u000D\u000A]+/g," "))},args:[{t:"string",r:false}],ret:"string"},translate:{fn:function(K,J,I){var F="",H,G,E;K=K.toString();J=J.toString();I=I.toString();for(H=0;H<K.length;H++){if((G=J.indexOf(E=K.charAt(H)))==-1||(E=I.charAt(G))){F+=E}}return new x(F)},args:[{t:"string"},{t:"string"},{t:"string"}],ret:"string"},"boolean":{fn:function(E){return new B(E.toBoolean())},args:[{r:true}],ret:"boolean"},not:{fn:function(E){return new B(!E.toBoolean())},args:[{t:"boolean"}],ret:"boolean"},"true":{fn:function(){return new B(true)},ret:"boolean"},"false":{fn:function(){return new B(false)},ret:"boolean"},lang:{fn:function(K){var E=this.node,I,L,N,M=K.toString().toLowerCase().split("-"),F,J,H,G;for(;E.nodeType!=9;E=f(E)){I=nodeAttribute(E);for(J=0;J<I.length;J++){L=I[J].nodeName.split(":");if(L.length===1){L[1]=L[0];L[0]=""}if(L[1]=="lang"){N=I[J].nodeValue.toLowerCase().split("-");if(N.length<M.length){continue}G=true;for(H=0;H<M.length;H++){if(M[H]!=N[H]){G=false;break}}if(G){F=nodeNamespace.call(this,E);for(H=0;H<F.length;H++){if(F[H].prefix==L[0]&&F[H].nodeValue==d){return new B(true)}}}}}}return new B(false)},args:[{t:"string"}],ret:"boolean"},number:{fn:function(E){if(arguments.length==0){E=new g([this.node],"document-order")}return new y(E.toNumber())},args:[{t:"object",r:false}],ret:"number"},sum:{fn:function(E){var F,G=0;E=E.toNodeSet();for(F=0;F<E.length;F++){G+=(new x(nodeStringValue(E[F]))).toNumber()}return new y(G)},args:[{t:"node-set"}],ret:"number"},floor:{fn:function(E){return new y(Math.floor(E))},args:[{t:"number"}],ret:"number"},ceiling:{fn:function(E){return new y(Math.ceil(E))},args:[{t:"number"}],ret:"number"},round:{fn:function(E){return new y(Math.round(E))},args:[{t:"number"}],ret:"number"}}};o=function(F,E){if(typeof C[E.type]!="function"){throw new Error("Internal Error: Expression type does not exist: "+E.type)}return C[E.type].apply(F,E.args)};s=function(E,F,G){switch(F){case s.NUMBER_TYPE:this.resultType=s.NUMBER_TYPE;this.numberValue=G.toNumber();break;case s.STRING_TYPE:this.resultType=s.STRING_TYPE;this.stringValue=G.toString();break;case s.BOOLEAN_TYPE:this.resultType=s.BOOLEAN_TYPE;this.booleanValue=G.toBoolean();break;case s.ANY_UNORDERED_NODE_TYPE:this.resultType=s.ANY_UNORDERED_NODE_TYPE;G=G.toNodeSet();this.singleNodeValue=(G.length)?G[0]:null;break;case s.UNORDERED_NODE_SNAPSHOT_TYPE:this.resultType=s.UNORDERED_NODE_SNAPSHOT_TYPE;if(!G instanceof g){throw new Error('Expected result of type "node-set", got: "'+G.type+'"')}this._value=G.toNodeSet();this.snapshotLength=this._value.length;break;case s.ORDERED_NODE_SNAPSHOT_TYPE:this.resultType=s.ORDERED_NODE_SNAPSHOT_TYPE;if(!G instanceof g){throw new Error('Expected result of type "node-set", got: "'+G.type+'"')}G.sortDocumentOrder();this._value=G.toNodeSet();this.snapshotLength=this._value.length;break;default:throw new w(w.TYPE_ERR,"XPath result type not supported. (type: "+F+")");break}};s.prototype={resultType:null,numberValue:null,stringValue:null,booleanValue:null,singleNodeValue:null,invalidIteratorState:null,snapshotLength:null,iterateNext:function(){},snapshotItem:function(E){return this._value[E]}};s.ANY_TYPE=0;s.NUMBER_TYPE=1;s.STRING_TYPE=2;s.BOOLEAN_TYPE=3;s.UNORDERED_NODE_ITERATOR_TYPE=4;s.ORDERED_NODE_ITERATOR_TYPE=5;s.UNORDERED_NODE_SNAPSHOT_TYPE=6;s.ORDERED_NODE_SNAPSHOT_TYPE=7;s.ANY_UNORDERED_NODE_TYPE=8;s.FIRST_ORDERED_NODE_TYPE=9;z=function(G,E,F){if(F.nodeType!=1){throw new Error("Internal Error: XPathNamespace owner element must be an Element node.")}this.ownerElement=F;this.ownerDocument=F.ownerDocument;this.nodeName="#namespace";this.prefix=G;this.localName=G;this.nodeType=z.XPATH_NAMESPACE_NODE;this.namespaceURI=E;this.nodeValue=E};z.XPATH_NAMESPACE_NODE=13;c={XPathException:w,XPathEvaluator:r,XPathNSResolver:b,XPathExpression:m,XPathResult:s,XPathNamespace:z,getCurrentDomLevel3XPathBindings:function(){return{window:{XPathException:window.XPathException,XPathExpression:window.XPathExpression,XPathNSResolver:window.XPathNSResolver,XPathResult:window.XPathResult,XPathNamespace:window.XPathNamespace},document:{createExpression:document.createExpression,createNSResolver:document.createNSResolver,evaluate:document.evaluate}}},createDomLevel3XPathBindings:function(E){var F=new r(E);return{window:{XPathException:w,XPathExpression:m,XPathNSResolver:b,XPathResult:s,XPathNamespace:z},document:{createExpression:function(){return F.createExpression.apply(F,arguments)},createNSResolver:function(){return F.createNSResolver.apply(F,arguments)},evaluate:function(){return F.evaluate.apply(F,arguments)}}}},bindDomLevel3XPath:function(H){var F=(H||c.createDomLevel3XPathBindings()),G=c.getCurrentDomLevel3XPathBindings(),E;for(E in F.window){window[E]=F.window[E]}for(E in F.document){document[E]=F.document[E]}return G}};return c})();